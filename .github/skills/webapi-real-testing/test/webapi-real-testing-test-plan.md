# Web API Testing SKILL 互動流程測試計畫

## 測試目標
驗證 webapi-real-testing SKILL 的互動流程是否符合規範要求，確保：
1. 正確檢測測試專案狀態
2. 強制詢問所有必要問題
3. 禁止擅自假設使用者需求
4. 正確處理不同的使用者選擇路徑

## 測試範圍

### 1. 專案檢測機制測試
#### 測試案例 1.1：檢測測試專案不存在
- **前置條件**：專案中不存在包含 "test" 的 .csproj 檔案
- **預期行為**：
  - 使用 Glob 工具搜尋 `**/*[Tt]est*.csproj`
  - 判定為「不存在測試專案」
  - 觸發初始化對話

#### 測試案例 1.2：檢測測試專案已存在
- **前置條件**：專案中存在 `*Test*.csproj` 或 `*Tests*.csproj` 檔案
- **預期行為**：
  - 偵測到測試專案
  - 驗證專案結構完整性
  - 若完整則進入正常測試開發模式

#### 測試案例 1.3：檢測測試專案結構不完整
- **前置條件**：測試專案存在但缺少核心檔案（BaseStep.cs, TestServer.cs）
- **預期行為**：
  - 偵測到結構不完整
  - 觸發測試專案建立對話

### 2. 互動流程測試

#### 測試案例 2.1：完整流程 - 空白專案 + xUnit
**測試路徑**：空白專案 → xUnit → 單一方案檔案

**預期互動順序**：
1. ⚠️ 偵測到專案尚未建立整合測試專案
2. 【問題 1/5】是否建立測試專案？
   - 選項：1️⃣ 是 / 2️⃣ 否
   - 使用者選擇：1
3. 【問題 2/5】選擇建立方式
   - 選項：1️⃣ 空白 / 2️⃣ 範本
   - 使用者選擇：1
4. 【問題 3/5】選擇測試框架
   - 選項：1️⃣ xUnit / 2️⃣ NUnit / 3️⃣ MSTest
   - 使用者選擇：1
5. 【問題 4/5】測試專案名稱
   - 使用者輸入：JobBank1111.Job.IntegrationTest
6. 【問題 5/5】測試專案位置
   - 選項：1️⃣ src/be/ / 2️⃣ tests/ / 3️⃣ 自訂
   - 使用者選擇：1
7. 🔍 偵測方案檔案
   - 偵測到 1 個 .sln
   - 自動加入該方案（無需詢問）
8. 📋 顯示配置摘要
9. 開始建立測試專案

**驗證重點**：
- ✅ 必須按順序詢問所有 5 個問題
- ✅ 不可跳過任何問題
- ✅ 不可擅自使用預設值
- ✅ 偵測到 1 個方案時自動加入，不詢問

#### 測試案例 2.2：完整流程 - 複製範本
**測試路徑**：複製範本 → 單一方案檔案

**預期互動順序**：
1. ⚠️ 偵測到專案尚未建立整合測試專案
2. 【問題 1/4】是否建立測試專案？- 使用者選擇：1
3. 【問題 2/4】選擇建立方式
   - 使用者選擇：2（複製範本）
4. 【問題 3/4】測試專案名稱
   - 使用者輸入：JobBank1111.Job.IntegrationTest
5. 【問題 4/4】測試專案位置
   - 使用者選擇：1
6. 📋 顯示配置摘要
7. 開始複製測試專案範本

**驗證重點**：
- ✅ 選擇範本時不詢問測試框架（因範本已包含）
- ✅ 僅詢問 4 個問題（比空白專案少 1 個）

#### 測試案例 2.3：完整流程 - 多個方案檔案
**測試路徑**：空白專案 → xUnit → 多個方案檔案

**預期互動順序**：
1-5. 同測試案例 2.1
6. 🔍 偵測方案檔案
   - 偵測到 2 個 .sln
   - ⚠️ 偵測到多個解決方案檔案
7. 【問題 6/6】選擇要加入的方案
   - 列出所有方案選項
   - 提供「不加入任何方案」選項
   - 使用者選擇：1
8. 📋 顯示配置摘要
9. 開始建立測試專案

**驗證重點**：
- ✅ 偵測到多個方案時必須詢問
- ✅ 不可擅自選擇方案

#### 測試案例 2.4：使用者選擇「否，暫時不需要」
**測試路徑**：拒絕建立測試專案

**預期互動順序**：
1. ⚠️ 偵測到專案尚未建立整合測試專案
2. 【問題 1/5】是否建立測試專案？
   - 使用者選擇：2（否）
3. 結束流程

**驗證重點**：
- ✅ 尊重使用者選擇，不強制建立
- ✅ 不再詢問後續問題

#### 測試案例 2.5：NUnit 測試框架流程
**測試路徑**：空白專案 → NUnit

**預期行為**：
- 使用 `dotnet new nunit` 建立專案
- 安裝 Reqnroll.NUnit 套件
- 調整測試屬性為 NUnit 格式

#### 測試案例 2.6：MSTest 測試框架流程
**測試路徑**：空白專案 → MSTest

**預期行為**：
- 使用 `dotnet new mstest` 建立專案
- 安裝 Reqnroll.MSTest 套件
- 調整測試屬性為 MSTest 格式

### 3. 錯誤處理測試

#### 測試案例 3.1：測試專案已存在
- **觸發條件**：Glob 搜尋發現現有測試專案
- **預期行為**：
  - 顯示警告訊息
  - 詢問使用者：使用現有 / 建立新的 / 取消

#### 測試案例 3.2：無方案檔案
- **觸發條件**：偵測到 0 個 .sln 檔案
- **預期行為**：
  - 警告：無方案檔案，跳過加入
  - 繼續建立測試專案

#### 測試案例 3.3：dotnet new 失敗
- **觸發條件**：dotnet new 指令執行失敗
- **預期行為**：
  - 顯示錯誤訊息
  - 提供解決建議

### 4. 禁止行為驗證測試

#### 測試案例 4.1：驗證不擅自假設建立測試專案
- **驗證點**：必須明確詢問「是否建立測試專案」
- **不可行為**：直接開始建立專案

#### 測試案例 4.2：驗證不擅自選擇建立方式
- **驗證點**：必須明確詢問「空白專案 or 複製範本」
- **不可行為**：假設使用推薦選項

#### 測試案例 4.3：驗證不擅自選擇測試框架
- **驗證點**：必須明確詢問測試框架
- **不可行為**：直接使用 xUnit（即使標註推薦）

#### 測試案例 4.4：驗證不擅自使用預設專案名稱
- **驗證點**：必須明確詢問專案名稱
- **不可行為**：使用範例名稱作為預設值

#### 測試案例 4.5：驗證不擅自選擇專案位置
- **驗證點**：必須明確詢問專案位置
- **不可行為**：假設使用推薦位置

#### 測試案例 4.6：驗證多方案時不擅自選擇
- **驗證點**：偵測到多個 .sln 時必須詢問
- **不可行為**：自動選擇第一個方案

### 5. 自動偵測邏輯測試

#### 測試案例 5.1：單一方案檔案自動加入
- **前置條件**：專案中恰好 1 個 .sln 檔案
- **預期行為**：
  - 顯示「偵測到 1 個解決方案檔案」
  - 自動加入該方案，不詢問使用者
  - 在配置摘要中註明「自動偵測」

#### 測試案例 5.2：多方案檔案強制詢問
- **前置條件**：專案中有 2 個以上 .sln 檔案
- **預期行為**：
  - 顯示「偵測到 N 個解決方案檔案」
  - 列出所有方案選項
  - 等待使用者選擇

#### 測試案例 5.3：無方案檔案警告
- **前置條件**：專案中無 .sln 檔案
- **預期行為**：
  - 顯示警告：無方案檔案
  - 跳過加入方案步驟
  - 繼續建立測試專案

## 測試執行策略

### 使用的 Agent
建議使用以下 agent 執行測試：
- **testing-engineer**: 專門負責測試策略設計與實作
- **task-executor**: 執行預先核准任務清單中的特定任務（如果需要）

### 測試工具
- **AskUserQuestion**: 驗證互動詢問機制
- **Glob**: 驗證專案檢測功能
- **Grep**: 驗證檔案搜尋功能
- **Read**: 驗證檔案讀取功能

### 測試環境準備
1. 建立模擬專案結構
2. 準備不同數量的 .sln 檔案（0個、1個、多個）
3. 準備測試用的 .csproj 檔案

## 測試報告格式

### 成功標準
- ✅ 所有測試案例通過
- ✅ 無擅自假設行為
- ✅ 互動順序正確
- ✅ 錯誤處理適當

### 失敗標準
- ❌ 跳過必要詢問
- ❌ 擅自使用預設值
- ❌ 互動順序錯誤
- ❌ 未正確處理邊界情況

## 測試優先順序

### P0（高優先級）
- 測試案例 2.1：完整流程 - 空白專案 + xUnit
- 測試案例 2.3：完整流程 - 多個方案檔案
- 測試案例 4.1-4.6：所有禁止行為驗證

### P1（中優先級）
- 測試案例 2.2：完整流程 - 複製範本
- 測試案例 2.5-2.6：其他測試框架
- 測試案例 5.1-5.3：自動偵測邏輯

### P2（低優先級）
- 測試案例 3.1-3.3：錯誤處理
- 測試案例 2.4：使用者拒絕建立

## 預期測試時間
- 高優先級測試：30 分鐘
- 中優先級測試：20 分鐘
- 低優先級測試：10 分鐘
- 總計：約 1 小時

## 備註
- 此測試計畫基於 SKILL.md 文件版本（截至讀取時間）
- 測試應在隔離環境中執行，避免影響實際專案
- 建議使用自動化腳本記錄互動流程
