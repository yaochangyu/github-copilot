---
name: api-development
description: API é–‹ç™¼æµç¨‹å¼•å°æŠ€èƒ½ï¼Œå”åŠ©é–‹ç™¼è€…é¸æ“‡åˆé©çš„é–‹ç™¼æµç¨‹ï¼ˆAPI First æˆ– Code Firstï¼‰ï¼Œä¸¦æä¾› OpenAPI è¦æ ¼ç®¡ç†ã€ç¨‹å¼ç¢¼ç”¢ç”Ÿç­‰è‡ªå‹•åŒ–æ”¯æ´ã€‚
---

# API Development Skill

## æè¿°
API é–‹ç™¼æµç¨‹å¼•å°æŠ€èƒ½ï¼Œå”åŠ©é–‹ç™¼è€…é¸æ“‡åˆé©çš„é–‹ç™¼æµç¨‹ï¼ˆAPI First æˆ– Code Firstï¼‰ï¼Œä¸¦æä¾› OpenAPI è¦æ ¼ç®¡ç†ã€ç¨‹å¼ç¢¼ç”¢ç”Ÿç­‰è‡ªå‹•åŒ–æ”¯æ´ã€‚

## è·è²¬
- å¼•å°é¸æ“‡ API First æˆ– Code First é–‹ç™¼æµç¨‹
- å”åŠ©æ›´æ–°/å»ºç«‹ OpenAPI è¦æ ¼ï¼ˆdoc/openapi.ymlï¼‰
- ç”¢ç”Ÿ Server Controller éª¨æ¶
- ç”¢ç”Ÿ Client SDK
- æä¾› Controller å¯¦ä½œæŒ‡å°

## èƒ½åŠ›

### 1. é–‹ç™¼æµç¨‹æ±ºç­–å¼•å°
å”åŠ©é–‹ç™¼è€…æ ¹æ“šå°ˆæ¡ˆéœ€æ±‚é¸æ“‡åˆé©çš„ API é–‹ç™¼æµç¨‹ï¼š
- **API Firstï¼ˆæ¨è–¦ï¼‰**ï¼šå¥‘ç´„å„ªå…ˆï¼Œæ–‡ä»¶èˆ‡å¯¦ä½œåŒæ­¥
- **Code First**ï¼šå¿«é€Ÿé–‹ç™¼ï¼Œå¾ŒçºŒç¶­è­·æ–‡ä»¶

### 2. OpenAPI è¦æ ¼ç®¡ç†
- æª¢æŸ¥ doc/openapi.yml æ˜¯å¦å­˜åœ¨
- å¼•å°æ–°å¢/ä¿®æ”¹ API ç«¯é»å®šç¾©
- æä¾› OpenAPI 3.0 è¦æ ¼ç¯„æœ¬
- é©—è­‰è¦æ ¼æª”æ¡ˆæ ¼å¼

### 3. ç¨‹å¼ç¢¼è‡ªå‹•ç”¢ç”Ÿ
- **Server Controller ç”¢ç”Ÿ**ï¼šåŸ·è¡Œ `task codegen-api-server`
- **Client SDK ç”¢ç”Ÿ**ï¼šåŸ·è¡Œ `task codegen-api-client`
- ç”¢ç”Ÿä½ç½®è‡ªå‹•åŒ–ç®¡ç†

### 4. Controller å¯¦ä½œå”åŠ©
- æä¾› Controller å¯¦ä½œç¯„æœ¬
- Result Pattern æ•´åˆæŒ‡å°
- HTTP ç‹€æ…‹ç¢¼æ˜ å°„å»ºè­°

## ä½¿ç”¨æ–¹å¼

### åœ¨ GitHub Copilot ä¸­ä½¿ç”¨
```
@workspace æˆ‘æƒ³è¦é–‹ç™¼æ–°çš„ API ç«¯é»
```

### ç›´æ¥å‘¼å« Skill
```
ä½¿ç”¨ api-development é–‹ç™¼ API
```

## äº’å‹•æµç¨‹

```mermaid
graph TD
    A[å•Ÿå‹• Skill] --> B{è©¢å• API é–‹ç™¼æµç¨‹}
    B -->|API First| C[æª¢æŸ¥ OpenAPI è¦æ ¼ç‹€æ…‹]
    B -->|Code First| D[è·³éè¦æ ¼ï¼Œç›´æ¥å¯¦ä½œ]
    C -->|å·²å®šç¾©| E[æé†’å·²å­˜åœ¨å®šç¾©]
    C -->|éœ€æ›´æ–°| F[å”åŠ©æ›´æ–° OpenAPI è¦æ ¼]
    C -->|å°šæœªå®šç¾©| G[å”åŠ©å»ºç«‹ OpenAPI è¦æ ¼]
    F --> H[åŸ·è¡Œ codegen-api-server]
    G --> H
    H --> I[ç”¢ç”Ÿ Controller éª¨æ¶]
    I --> J[æä¾› Controller å¯¦ä½œç¯„æœ¬]
    J --> K[è©¢å•æ˜¯å¦ç”¢ç”Ÿ Client SDK]
    K -->|æ˜¯| L[åŸ·è¡Œ codegen-api-client]
    K -->|å¦| M[å®Œæˆ]
    L --> M
    D --> N[æä¾› Code First æŒ‡å°]
    N --> O[æé†’å¾ŒçºŒéœ€æ‰‹å‹•ç¶­è­· OpenAPI]
    O --> M
```

## äº’å‹•å•ç­”ç¯„ä¾‹

### å•é¡Œ 1ï¼šAPI é–‹ç™¼æµç¨‹é¸æ“‡

```
è«‹é¸æ“‡ API é–‹ç™¼æµç¨‹ï¼š

1ï¸âƒ£ API Firstï¼ˆæ¨è–¦ï¼‰
   âœ… API æ–‡ä»¶èˆ‡å¯¦ä½œ 100% åŒæ­¥
   âœ… å‰å¾Œç«¯å¯ä¸¦è¡Œé–‹ç™¼
   âœ… è‡ªå‹•ç”¢ç”Ÿ Client SDK
   âœ… ç·¨è­¯æ™‚å¥‘ç´„æª¢æŸ¥
   âš ï¸ éœ€å…ˆè¨­è¨ˆ API è¦æ ¼

   é©ç”¨å ´æ™¯ï¼š
   - å‰å¾Œç«¯åˆ†é›¢ä¸”åœ˜éšŠä¸¦è¡Œé–‹ç™¼
   - éœ€è¦æä¾› Client SDK çµ¦ç¬¬ä¸‰æ–¹
   - API ç©©å®šæ€§è¦æ±‚é«˜
   - å¤šå€‹å®¢æˆ¶ç«¯ï¼ˆWebã€Mobileã€Desktopï¼‰

2ï¸âƒ£ Code First
   âœ… å¿«é€Ÿå•Ÿå‹•é–‹ç™¼
   âœ… ç›´æ¥å¯¦ä½œç¨‹å¼ç¢¼
   âš ï¸ éœ€æ‰‹å‹•ç¶­è­· API æ–‡ä»¶
   âš ï¸ æ–‡ä»¶èˆ‡å¯¦ä½œå¯èƒ½ä¸åŒæ­¥

   é©ç”¨å ´æ™¯ï¼š
   - å¿«é€ŸåŸå‹é©—è­‰
   - å…§éƒ¨å°å‹å°ˆæ¡ˆ
   - API çµæ§‹ä»åœ¨å¿«é€Ÿè®Šå‹•ä¸­
   - å–®äººé–‹ç™¼æˆ–å°åœ˜éšŠ
```

### å•é¡Œ 2ï¼šOpenAPI è¦æ ¼å®šç¾©ç‹€æ…‹ï¼ˆåƒ… API Firstï¼‰

```
è«‹ç¢ºèª OpenAPI è¦æ ¼ç‹€æ…‹ï¼š

1ï¸âƒ£ å·²å®šç¾©
   - doc/openapi.yml å·²åŒ…å«æ­¤ API çš„ç«¯é»å®šç¾©
   - æˆ‘åªéœ€è¦ç”¢ç”Ÿç¨‹å¼ç¢¼

2ï¸âƒ£ éœ€è¦æ›´æ–°
   - doc/openapi.yml å­˜åœ¨ä½†éœ€è¦åŠ å…¥æ–°çš„ç«¯é»
   - æˆ‘éœ€è¦å”åŠ©ä¿®æ”¹è¦æ ¼

3ï¸âƒ£ å°šæœªå®šç¾©
   - doc/openapi.yml ä¸å­˜åœ¨æˆ–æ²’æœ‰æ­¤ç«¯é»
   - æˆ‘éœ€è¦å¾é ­å»ºç«‹è¦æ ¼
```

### å•é¡Œ 3ï¼šéœ€è¦å¯¦ä½œçš„åˆ†å±¤

```
è«‹é¸æ“‡éœ€è¦å¯¦ä½œçš„åˆ†å±¤ï¼ˆå¯å¤šé¸ï¼‰ï¼š

â˜‘ï¸ Controller
   - HTTP è«‹æ±‚è™•ç†èˆ‡è·¯ç”±
   - è«‹æ±‚é©—è­‰
   - HTTP ç‹€æ…‹ç¢¼å°æ‡‰

â˜‘ï¸ Handler
   - æ¥­å‹™é‚è¼¯è™•ç†
   - æµç¨‹å”èª¿
   - éŒ¯èª¤è™•ç†èˆ‡çµæœå°è£

â˜‘ï¸ Repository
   - è³‡æ–™å­˜å–é‚è¼¯
   - EF Core æ“ä½œ
   - è³‡æ–™åº«æŸ¥è©¢å°è£

æç¤ºï¼šé€šå¸¸éœ€è¦ä¸‰å±¤éƒ½å¯¦ä½œä»¥å®Œæˆå®Œæ•´åŠŸèƒ½
```

### å•é¡Œ 4ï¼šæ˜¯å¦ç”¢ç”Ÿ Client SDK

```
æ˜¯å¦éœ€è¦ç”¢ç”Ÿ Client SDKï¼Ÿ

1ï¸âƒ£ æ˜¯ï¼Œç”¢ç”Ÿ Client SDK
   - è‡ªå‹•ç”¢ç”Ÿå¼·å‹åˆ¥ API å®¢æˆ¶ç«¯
   - å‰ç«¯å¯ç›´æ¥ä½¿ç”¨
   - å®Œæ•´çš„ IntelliSense æ”¯æ´
   - ç”¢ç”Ÿä½ç½®ï¼šJobBank1111.Job.Contract/AutoGenerated/

2ï¸âƒ£ å¦ï¼Œæš«ä¸ç”¢ç”Ÿ
   - åƒ…ç”¢ç”Ÿ Server Controller
   - å¾ŒçºŒå¯éš¨æ™‚åŸ·è¡Œ task codegen-api-client
```

## OpenAPI è¦æ ¼ç¯„æœ¬

### ç«¯é»å®šç¾©ç¯„ä¾‹

```yaml
paths:
  /api/v1/members:
    post:
      summary: å»ºç«‹æ–°æœƒå“¡
      operationId: CreateMember
      tags:
        - Member
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMemberRequest'
      responses:
        '201':
          description: æœƒå“¡å»ºç«‹æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberResponse'
        '400':
          description: è«‹æ±‚é©—è­‰å¤±æ•—
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Failure'
        '409':
          description: Email å·²è¢«ä½¿ç”¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Failure'
        '500':
          description: å…§éƒ¨ä¼ºæœå™¨éŒ¯èª¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Failure'

components:
  schemas:
    CreateMemberRequest:
      type: object
      required:
        - email
        - name
      properties:
        email:
          type: string
          format: email
          example: "user@example.com"
        name:
          type: string
          minLength: 1
          maxLength: 100
          example: "å¼µä¸‰"
        phone:
          type: string
          pattern: '^\d{10}$'
          example: "0912345678"

    MemberResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        createdAt:
          type: string
          format: date-time
```

## ç¨‹å¼ç¢¼ç”¢ç”Ÿå‘½ä»¤

### Server Controller ç”¢ç”Ÿ
```bash
# åŸ·è¡Œ Taskfile å‘½ä»¤
task codegen-api-server

# ç”¢ç”Ÿä½ç½®
# JobBank1111.Job.WebAPI/Contract/AutoGenerated/
```

### Client SDK ç”¢ç”Ÿ
```bash
# åŸ·è¡Œ Taskfile å‘½ä»¤
task codegen-api-client

# ç”¢ç”Ÿä½ç½®
# JobBank1111.Job.Contract/AutoGenerated/
```

## Controller å¯¦ä½œæŒ‡å°

ç”¢ç”Ÿçš„ Controller éª¨æ¶éœ€è¦å¯¦ä½œè‡ªå‹•ç”¢ç”Ÿçš„ä»‹é¢ï¼Œæ•´åˆä»¥ä¸‹å…ƒä»¶ï¼š

1. **Handler æ•´åˆ**ï¼šå‘¼å«æ¥­å‹™é‚è¼¯å±¤
2. **Result Pattern è™•ç†**ï¼šè½‰æ› Result ç‚º HTTP å›æ‡‰
3. **HTTP ç‹€æ…‹ç¢¼æ˜ å°„**ï¼šä½¿ç”¨ FailureCodeMapper

å®Œæ•´å¯¦ä½œç¯„æœ¬è«‹åƒè€ƒï¼š`assets/controller-template.cs`

## API First vs Code First å°æ¯”

| æ¯”è¼ƒé …ç›® | API Firstï¼ˆæ¨è–¦ï¼‰ | Code First |
|---------|------------------|-----------|
| **æ–‡ä»¶åŒæ­¥** | âœ… è‡ªå‹• 100% åŒæ­¥ | âŒ éœ€æ‰‹å‹•ç¶­è­· |
| **å‰å¾Œç«¯å”ä½œ** | âœ… å¯ä¸¦è¡Œé–‹ç™¼ | âš ï¸ éœ€ç­‰å¾Œç«¯å®Œæˆ |
| **å¥‘ç´„ä¿è­‰** | âœ… ç·¨è­¯æ™‚æª¢æŸ¥ | âŒ åŸ·è¡Œæ™‚æ‰ç™¼ç¾ |
| **Client SDK** | âœ… è‡ªå‹•ç”¢ç”Ÿ | âŒ éœ€æ‰‹å‹•å¯¦ä½œ |
| **é–‹ç™¼é€Ÿåº¦** | âš ï¸ éœ€å…ˆè¨­è¨ˆ API | âœ… å¿«é€Ÿå•Ÿå‹• |
| **ç¶­è­·æˆæœ¬** | âœ… ä½ï¼ˆè‡ªå‹•åŒæ­¥ï¼‰ | âŒ é«˜ï¼ˆæ‰‹å‹•ç¶­è­·ï¼‰ |
| **åœ˜éšŠå”ä½œ** | âœ… å„ªç§€ | âš ï¸ ä¸€èˆ¬ |
| **é©ç”¨å ´æ™¯** | ä¸­å¤§å‹å°ˆæ¡ˆã€åœ˜éšŠå”ä½œ | å°å‹å°ˆæ¡ˆã€å¿«é€ŸåŸå‹ |

## å®Œæ•´é–‹ç™¼æµç¨‹ç¯„ä¾‹ï¼ˆAPI Firstï¼‰

### æ­¥é©Ÿ 1ï¼šå®šç¾© OpenAPI è¦æ ¼
ç·¨è¼¯ `doc/openapi.yml`ï¼Œæ–°å¢ API ç«¯é»å®šç¾©ã€‚

### æ­¥é©Ÿ 2ï¼šç”¢ç”Ÿ Server Controller
```bash
task codegen-api-server
```

ç”¢ç”Ÿæª”æ¡ˆï¼š
- `JobBank1111.Job.WebAPI/Contract/AutoGenerated/IMemberApi.cs`ï¼ˆä»‹é¢ï¼‰

### æ­¥é©Ÿ 3ï¼šå¯¦ä½œ Controller
å»ºç«‹ `MemberController.cs` å¯¦ä½œè‡ªå‹•ç”¢ç”Ÿçš„ä»‹é¢ï¼š

```csharp
[ApiController]
[Route("api/v1/members")]
public class MemberController(MemberHandler handler) : ControllerBase, IMemberApi
{
    public async Task<IActionResult> CreateMember(
        CreateMemberRequest request,
        CancellationToken cancellationToken = default)
    {
        var result = await handler.CreateMemberAsync(request, cancellationToken);

        return result.Match(
            success => StatusCode(201, success),
            failure => StatusCode(
                FailureCodeMapper.ToHttpStatusCode(failure.Code),
                failure)
        );
    }
}
```

### æ­¥é©Ÿ 4ï¼šç”¢ç”Ÿ Client SDKï¼ˆå¯é¸ï¼‰
```bash
task codegen-api-client
```

ç”¢ç”Ÿæª”æ¡ˆï¼š
- `JobBank1111.Job.Contract/AutoGenerated/IMemberApi.cs`ï¼ˆClient ä»‹é¢ï¼‰
- `JobBank1111.Job.Contract/AutoGenerated/MemberApiClient.cs`ï¼ˆClient å¯¦ä½œï¼‰

## åƒè€ƒæ–‡ä»¶
- [API é–‹ç™¼å·¥ä½œæµç¨‹è©³è§£](./references/api-development-workflow.md)

## ç¯„æœ¬æª”æ¡ˆ
- [Controller å¯¦ä½œç¯„æœ¬](./assets/controller-template.cs)
- [OpenAPI ç«¯é»ç¯„æœ¬](./assets/openapi-endpoint-template.yml)

## æ³¨æ„äº‹é …

### ğŸ”’ æ ¸å¿ƒåŸå‰‡
1. **å¼·åˆ¶è©¢å•**ï¼šä¸å¾—æ“…è‡ªå‡è¨­é–‹ç™¼æµç¨‹ï¼Œå¿…é ˆæ˜ç¢ºè©¢å•
2. **æ–‡ä»¶å„ªå…ˆ**ï¼šAPI First æ™‚ï¼Œè¦æ ¼å®šç¾©å¿…é ˆåœ¨å¯¦ä½œä¹‹å‰
3. **è‡ªå‹•ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼ä¸å¯æ‰‹å‹•ç·¨è¼¯**ï¼šä½æ–¼ AutoGenerated è³‡æ–™å¤¾

### ğŸ“‹ æœ€ä½³å¯¦è¸
1. **API First å„ªå…ˆ**ï¼šé™¤éæœ‰ç‰¹æ®Šç†ç”±ï¼Œå»ºè­°ä½¿ç”¨ API First
2. **è¦æ ¼å®Œæ•´æ€§**ï¼šç¢ºä¿ OpenAPI è¦æ ¼åŒ…å«å®Œæ•´çš„éŒ¯èª¤å›æ‡‰å®šç¾©
3. **ç‰ˆæœ¬æ§åˆ¶**ï¼šAPI è·¯å¾‘æ‡‰åŒ…å«ç‰ˆæœ¬è™Ÿï¼ˆå¦‚ /api/v1/ï¼‰
4. **ä¸€è‡´æ€§**ï¼šéµå¾ªç¾æœ‰ API çš„å‘½åèˆ‡çµæ§‹é¢¨æ ¼

### âœ… æˆåŠŸæŒ‡æ¨™
- [ ] OpenAPI è¦æ ¼æ­£ç¢ºå®šç¾©ï¼ˆAPI Firstï¼‰
- [ ] Server Controller æˆåŠŸç”¢ç”Ÿ
- [ ] Controller æ­£ç¢ºå¯¦ä½œä»‹é¢
- [ ] Client SDK æˆåŠŸç”¢ç”Ÿï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] API æ–‡ä»¶èˆ‡å¯¦ä½œåŒæ­¥

## éŒ¯èª¤è™•ç†

### codegen å‘½ä»¤å¤±æ•—
```
âŒ éŒ¯èª¤ï¼šç„¡æ³•ç”¢ç”Ÿç¨‹å¼ç¢¼

åŸ·è¡Œå‘½ä»¤ï¼štask codegen-api-server
éŒ¯èª¤è¨Šæ¯ï¼šOpenAPI è¦æ ¼æ ¼å¼éŒ¯èª¤

å»ºè­°ï¼š
1. æª¢æŸ¥ doc/openapi.yml æ ¼å¼æ˜¯å¦æ­£ç¢º
2. ä½¿ç”¨ç·šä¸Šé©—è­‰å·¥å…·ï¼šhttps://editor.swagger.io/
3. ç¢ºèª YAML ç¸®æ’æ­£ç¢ºï¼ˆä½¿ç”¨ç©ºæ ¼ï¼Œä¸ä½¿ç”¨ Tabï¼‰
```

### ç”¢ç”Ÿçš„ Controller ç·¨è­¯å¤±æ•—
```
âŒ éŒ¯èª¤ï¼šController ç·¨è­¯å¤±æ•—

éŒ¯èª¤è¨Šæ¯ï¼šCS0535: 'MemberController' does not implement interface member 'IMemberApi.CreateMember'

å»ºè­°ï¼š
1. ç¢ºèªæ–¹æ³•ç°½ç« èˆ‡ä»‹é¢å®šç¾©å®Œå…¨ä¸€è‡´
2. æª¢æŸ¥åƒæ•¸åç¨±ã€é¡å‹ã€å›å‚³é¡å‹
3. åƒè€ƒç¯„æœ¬ï¼šassets/controller-template.cs
```

## ç›¸é—œ Skills
- `handler` - Handler æ¥­å‹™é‚è¼¯å¯¦ä½œ
- `error-handling` - Result Pattern éŒ¯èª¤è™•ç†
- `bdd-testing` - API ç«¯é»æ¸¬è©¦

## ç›¸é—œ Agents
- `feature-development-agent` - ä½¿ç”¨æœ¬ skill çš„å®Œæ•´åŠŸèƒ½é–‹ç™¼æµç¨‹
